#!/bin/sh

indent() {
  sed -u 's/^/       /'
}

echo "-----> Found a main.lua"

# if hello.txt has contents, display them (indented to align)
# otherwise error

if [ ! -s $1/main.lua ]; then
  echo "main.lua was empty"
  exit 1
else
  echo "Downloading turbo.lua self-contained pack" | indent
  PATH=$PATH:/sbin
  curl https://raw.github.com/enotodden/turbo-virtual-env/master/turbo-virtual-env | bash -s - --create $1/env
  sed -i 's/\/usr\/local\/lib\/libtffi_wrap.so/\/app\/env\/turbo\/libtffi_wrap.so/g' $1/turbo/httputil.lua
  sed -i 's/\/usr\/local\/lib\/libtffi_wrap.so/\/app\/env\/turbo\/libtffi_wrap.so/g' $1/turbo/iostream.lua
fi | indent
